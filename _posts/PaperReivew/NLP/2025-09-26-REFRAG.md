---
title: "[논문리뷰]REFRAG: Rethinking RAG based Decoding(Meta, 2025)"

categories: 
  - NR
  
toc: true
toc_sticky: true

date: 2025-09-26
last_modified_at: 2025-09-26
---

*Xiaoqiang Lin, Aritra Ghosh, Bryan Kian Hsiang Low, Anshumali Shrivasava, and Vijai Mohan*. 2025. [**REFRAG: Rethinking RAG based Decoding**](https://arxiv.org/abs/2509.01092). arXiv:2509.01092 [cs.CL] https://arxiv.org/abs/2509.01092

# Problem Statement
이 논문은 **RAG(Retrieval-Augmented Generation)** 기반 응용에서 **효율적인 디코딩 구조**를 제안하는 연구이다. 기존 LLM은 긴 컨텍스트 입력 시 **높은 지연(latency)과 메모리 사용량 증가** 문제로 인해 웹 스케일 검색, 멀티턴 대화, 문서 요약 등 실시간성이 중요한 응용에서 성능 저하를 겪는다. 특히 <span style="color:gold">**RAG에서는 입력의 대부분이 검색된 문서(passage)들이며, 그중 일부만 실제 질의에 유효**</span>하다. 저자들은 이러한 RAG 특유의 구조적 특성을 고려한 디코딩 최적화가 필요하다고 주장한다.

- **[비효율적인 토큰 할당]** RAG 컨텍스트에는 정보가 희소하고 많은 문서가 관련성이 낮거나나 반복적으로 등장하지만, 기존 연구들은 모든 토큰에 동일하게 메모리와 연산을 할당한다. 이로 인해 불필요한 자원 낭비가 발생한다.
- **[검색 정보의 낭비]** RAG에서 retrieval 과정은 이미 문서를 벡터화하고 쿼리와의 연관성을 계산하여 다양한 정보를 제공하지만, 디코딩 과정에서는 이러한 정보를 활용하지 않고 폐기한다. 이는 중복 계산을 초래한다.
- **[비정형적이고 희소한 어텐션]** RAG에서는 다양성과 중복 제거(deduplication)로 인해 문서 간 상호작용이 거의 없어 **block-diagonal 형태의 희소 어텐션 패턴**이 나타난다. 그러나 기존 연구들은 이러한 구조적 특성을 고려하지 않아 비효율이 발생한다.

<p align="center">
<img width="1000" alt="1" src="https://github.com/meaningful96/Blogging/blob/main/Paper_Review/%5B2025.09.26%5DREFRAG/figure1.png?raw=true">
</p>

REFRAG 저자들이 지적하는 가장 근본적인 문제의 핵심은 <span style="color:gold">**RAG 컨텍스트의 “희소한 어텐션(Sparse Attention)” 패턴**</span>이다. RAG 컨텍스트가 불필요한 계산을 유발하는 독특한 내부 구조를 가지고 있다는 것이다. 이를 실험적으로 보여주기위해, 여러 문서를 하나로 합쳐 LLM에 입력시켰을 경우 문서 쌍간의 어텐션 값을 시각화 한 것이 위의 그림이다.

LLaMA-2-7B 모델의 32개 레이어(layer 0 ~ layer 31) 각각에서 계산된 어텐션 값의 평균을 시각화한 것으로, 여기서 P0, P1, P2, P3, P4는 RAG 시스템이 사용자의 질문에 답변하기 위해 외부 데이터베이스(예: 벡터 DB)에서 검색해 온 5개의 서로 다른 문서(문서)를 의미한다. 

- <span style=”color:coral”>**대각 성분 (Red)**</span>: 대각선의 붉은 값들은 각 문서별로 자기 자신과의 (e.g., P0-P0 & P1-P1) 어텐션 결과를 보여준다. 동일한 문서의 내부 토큰들 간의 어텐션은 당연히 매우 강할수 밖에 없으며 이는 너무 자명한 사실이다.
- <span style=”color:aqua”>**비대각 성분 (Blue)**</span>: 서로 다른 문서들 간의 어텐션 값이 낮아 대부분이 옅은 파란색을 띈다. 이는 서로 다른 문서 내의 토큰들 간의 연관성이 떨어짐을 의미한다.

다양성 확보나 중복 제거 과정을 거친 컨텍스트들은 실제 추론 단계에서 서로 의미적으로 연결될 필요가 거의 없기 때문에, 결과적으로 **컨텍스트 간 어텐션이 희소하게 분포하는 블록-대각선(block-diagonal) 구조**가 나타난다는 것이다. REFRAG는 이러한 구조적 특성에서 비롯되는 **불필요한 계산을 제거**함으로써 추론 속도를 크게 높이는 아이디어에서 출발한다.

